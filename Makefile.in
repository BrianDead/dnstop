PROG=dnstop
DATE != date +%Y%m%d

CC=@CC@
CFLAGS=@CFLAGS@
LIBS=@LIBS@
OPTFLAGS=@OPTFLAGS@
PREFIX=@prefix@

SRCS=	$(PROG).c \
	hashtbl.c \
	hashtbl.h \
	known_tlds.h \
	lookup3.c

OBJS=	$(PROG).o \
	hashtbl.o \
	lookup3.o

BINDIR=$(PREFIX)/bin
DATADIR=$(PREFIX)/share
MANDIR=$(DATADIR)/man

all: $(PROG)

$(PROG): $(OBJS)
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(OBJS) ${LIBS}

dnstop.o: dnstop.c
	$(CC) $(CFLAGS) $(OPTFLAGS) -c $<

clean:
	rm -f $(PROG) $(OBJS) $(PROG).core $(PROG).c~

distclean: clean
	rm -rf autom4te.cache
	rm -f config.h
	rm -f config.log
	rm -f config.status
	rm -f config.status.lineno
	rm -f Makefile

tar:
	mkdir $(PROG)-$(DATE)
	cp -p LICENSE CHANGES $(SRCS) $(PROG).8 Makefile $(PROG)-$(DATE)
	perl -pi -e "s/\@VERSION\@/$(DATE)/" $(PROG)-$(DATE)/dnstop.c
	tar czvf $(PROG)-$(DATE).tar.gz $(PROG)-$(DATE)
	chmod 444 $(PROG)-$(DATE).tar.gz
	rm -rf $(PROG)-$(DATE)
	md5 *.gz > MD5s.txt

install: $(PROG)
	install -m 755 $(PROG) $(BINDIR)
	install -m 644 $(PROG).8 $(MANDIR)/man8

uninstall:
	rm -f $(BINDIR)/$(PROG)
	rm -f $(MANDIR)/man8/$(PROG).8
